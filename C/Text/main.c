#include <stdio.h>
#include <iocslib.h>
#include <stdint.h>

#include "Common.h"
#include "Text.h"

//0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0,
//0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0,
//0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0,
//0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0,
//0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0,
//0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0,
//0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0,
//0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0,

//0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0,
//0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0,
//0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0,
//0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0,
//0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0,
//0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0,
//0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0,
//0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0,
const uint16_t TextData[][16] = {
  {
    PLANE0(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE0(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE0(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE0(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE0(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE0(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE0(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE0(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE0(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE0(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE0(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE0(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE0(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE0(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE0(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE0(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
  {
    PLANE1(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE1(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE1(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE1(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE1(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE1(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE1(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE1(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE1(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE1(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE1(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE1(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE1(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE1(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE1(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE1(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
  {
    PLANE2(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE2(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE2(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE2(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE2(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE2(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE2(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE2(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE2(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE2(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE2(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE2(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE2(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE2(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE2(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE2(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
  {
    PLANE3(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE3(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE3(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE3(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE3(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE3(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE3(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE3(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE3(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE3(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE3(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE3(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE3(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE3(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE3(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE3(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
};

void main()
{ 
  const int PrevCRT = CRTMOD(-1);
  CRTMOD(CRT_MODE_HIGH_256X256_T16G16_512);
  B_CUROFF();
  B_CLR_AL();

  //TPALET2(0, COL_BLACK);
  TPALET2(1, COL_RED);
  TPALET2(2, COL_YELLOW);
  TPALET2(3, COL_GRAY);

  for(int i = 0;i < COUNTOF(TextData);++i) {
    for(int j = 0; j < COUNTOF(TextData[0]);++j){
      struct TXFILLPTR Fill = { .vram_page = i, .x = 0, .y = j, .x1 = 16*10, .y1 = j, .fill_patn = TextData[i][j] };
      TXFILL(&Fill);
    }
  }

  struct XLINEPTR XLine = { .vram_page = 0, .x = 32, .y = 32, .x1 = 32+8, .line_style = 0xf7f7 };
  TXXLINE(&XLine);
  struct YLINEPTR YLine = { .vram_page = 0, .x = 32 + 16, .y = 32 + 8, .y1 = 32+8, .line_style = 0xf7f7 };
  TXYLINE(&YLine);
  //struct TLINEPTR Line = { .vram_page = 0, .x = 32, .y = 32, .x1 = 32+8, .y1 = 32+8, .line_style = 0xf7f7 };
  //TXLINE(&Line);

  struct TBOXPTR Box = { .vram_page = 0, .x = 64, .y = 64, .x1 = 32, .y1 = 32, .line_style = 0x7f7f };
  TXBOX(&Box);
  struct TXFILLPTR Fill = { .vram_page = 0, .x = 128, .y = 128, .x1 = 32, .y1 = 32, .fill_patn = 0xffff };
  TXFILL(&Fill);

  //!< 単位は 4 ラスタ単位
  TXRASCPY(RAS_SRC_DST(0, 32), 4, RAS_PLANE_ALL | RAS_DIR_INC);
  TXRASCPY(RAS_SRC_DST(0, 36), 4, RAS_PLANE0 | RAS_DIR_INC);
  TXRASCPY(RAS_SRC_DST(0, 40), 4, RAS_PLANE1 | RAS_DIR_INC);
  TXRASCPY(RAS_SRC_DST(0, 44), 4, RAS_PLANE2 | RAS_DIR_INC);
  TXRASCPY(RAS_SRC_DST(0, 48), 4, RAS_PLANE3 | RAS_DIR_INC);
  TXRASCPY(RAS_SRC_DST(0, 52), 4, RAS_PLANE_ALL | RAS_DIR_INC);
  
  int TAB_PREV = 0;
  while (1)
  {      
    if(ESC_ON) { break; }

    int TAB_CUR = TAB_ON;
    if(TAB_PUSH(TAB_PREV)) {
      //!< 色が反転される
      struct TREVPTR Rev = { .vram_page = 0, .x = 0, .y = 0, .x1 = 256, .y1 = 256 };
      TXREV(&Rev);
    }
    TAB_PREV = TAB_CUR;
  }
  
  B_CURON();
  CRTMOD(PrevCRT);
}

