#include <stdio.h>
#include <iocslib.h>
#include <stdint.h>

#include "Common.h"
#include "Text.h"

//0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0,
//0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0,
//0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0,
//0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0,
//0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0,
//0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0,
//0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0,
//0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0,

//0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0,
//0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0,
//0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0,
//0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0,
//0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0,
//0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0,
//0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0,
//0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0,

const uint16_t TextData[4][16] = {
  {
    PLANE0(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE0(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE0(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE0(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE0(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE0(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE0(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE0(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE0(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE0(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE0(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE0(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE0(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE0(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE0(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE0(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
  {
    PLANE1(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE1(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE1(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE1(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE1(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE1(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE1(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE1(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE1(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE1(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE1(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE1(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE1(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE1(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE1(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE1(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
  {
    PLANE2(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE2(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE2(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE2(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE2(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE2(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE2(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE2(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE2(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE2(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE2(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE2(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE2(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE2(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE2(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE2(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
  {
    PLANE3(0,0,0,0,0,1,1,1, 1,1,0,0,0,0,0,0),
    PLANE3(0,0,0,0,1,1,1,1, 1,1,1,1,1,0,0,0),
    PLANE3(0,0,0,0,3,3,3,2, 2,3,2,0,0,0,0,0),
    PLANE3(0,0,0,3,2,3,2,2, 2,3,2,2,2,0,0,0),
    PLANE3(0,0,0,3,2,3,3,2, 2,2,3,2,2,2,0,0),
    PLANE3(0,0,0,3,3,2,2,2, 2,3,3,3,3,0,0,0),
    PLANE3(0,0,0,0,0,2,2,2, 2,2,2,2,0,0,0,0),
    PLANE3(0,0,0,0,3,3,1,3, 3,3,0,0,0,0,0,0),

    PLANE3(0,0,0,3,3,3,1,3, 3,1,3,3,3,0,0,0),
    PLANE3(0,0,3,3,3,3,1,1, 1,1,3,3,3,3,0,0),
    PLANE3(0,0,2,2,3,1,2,1, 1,2,1,3,2,2,0,0),
    PLANE3(0,0,2,2,2,1,1,1, 1,1,1,2,2,2,0,0),
    PLANE3(0,0,2,2,1,1,1,1, 1,1,1,1,2,2,0,0),
    PLANE3(0,0,0,0,1,1,1,0, 0,1,1,1,0,0,0,0),
    PLANE3(0,0,0,3,3,3,0,0, 0,0,3,3,3,0,0,0),
    PLANE3(0,0,3,3,3,3,0,0, 0,0,3,3,3,3,0,0),
  },
};

// void	TXRASCPY(int, int, int);

void main()
{ 
  const int PrevCRT = CRTMOD(-1);
  CRTMOD(CRT_MODE_HIGH_256X256_T16G16_512);
  B_CUROFF();
  B_CLR_AL();

  TPALET2(1, COL_RED);
  TPALET2(2, COL_YELLOW);
  TPALET2(3, COL_GRAY);

  for(int i = 0;i < COUNTOF(TextData);++i) {
    for(int j = 0; j < COUNTOF(TextData[0]);++j){
      struct TXFILLPTR Fill = { .vram_page = i, .x = 0, .y = j, .x1 = 16*10, .y1 = j, .fill_patn = TextData[i][j] };
      TXFILL(&Fill);
    }
  }

  struct XLINEPTR XLine = { .vram_page = 0, .x = 32, .y = 32, .x1 = 32+8, .line_style = 0xf7f7 };
  TXXLINE(&XLine);
  struct YLINEPTR YLine = { .vram_page = 0, .x = 32, .y = 32, .y1 = 32+8, .line_style = 0xf7f7 };
  TXYLINE(&YLine);
  //struct TLINEPTR Line = { .vram_page = 0, .x = 32, .y = 32, .x1 = 32+8, .y1 = 32+8, .line_style = 0xf7f7 };
  //TXLINE(&Line);

  struct TBOXPTR Box = { .vram_page = 0, .x = 64, .y = 64, .x1 = 64, .y1 = 64, .line_style = 0x7f7f };
  TXBOX(&Box);
  struct TXFILLPTR Fill = { .vram_page = 0, .x = 128, .y = 128, .x1 = 64, .y1 = 64, .fill_patn = 0xffff };
  TXFILL(&Fill);

  // struct XLINEPTR XLine1 = { .vram_page = 1, .x = 32, .y = 32+10, .x1 = 64, .line_style = 0xf7f7 };
  // TXXLINE(&XLine1);
  // struct XLINEPTR XLine2 = { .vram_page = 2, .x = 32, .y = 32+20, .x1 = 64, .line_style = 0xf7f7 };
  // TXXLINE(&XLine2);
  // struct XLINEPTR XLine3 = { .vram_page = 3, .x = 32, .y = 32+30, .x1 = 64, .line_style = 0xf7f7 };
  // TXXLINE(&XLine3);

  //!< F‚ª”½“]‚³‚ê‚é
  struct TREVPTR Rev = { .vram_page = 0, .x = 0, .y = 0, .x1 = 256, .y1 = 256 };
  TXREV(&Rev);
  TXREV(&Rev);

  while (1)
  {      
    if(ESC_ON) { break; }
  }
  
  B_CURON();
  CRTMOD(PrevCRT);
}

